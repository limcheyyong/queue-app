<div class="container mx-auto p-4 max-w-4xl">
  <h1 class="text-2xl font-bold text-center mb-6">羽毛球排隊系統</h1>

  <!-- 添加玩家表單 -->
  <div class="mb-6 flex flex-wrap gap-2">
    <form
      [formGroup]="form"
      class="flex flex-grow items-center gap-2 min-w-[280px]"
    >
      <input
        type="text"
        formControlName="name"
        placeholder="輸入玩家姓名"
        class="p-1.5 border rounded flex-grow"
      />
      <select formControlName="level" class="p-2 border rounded w-36">
        <option *ngFor="let item of levelOptions" [value]="item.value">
          {{ item.label }}
        </option>
      </select>
    </form>

    <button
      (click)="addPlayer()"
      class="p-2 bg-blue-500 text-white rounded flex items-center gap-1"
    >
      <i class="fa-solid fa-plus"></i> 添加玩家
    </button>

    <button
      (click)="addCourt()"
      class="p-2 bg-green-500 text-white rounded flex items-center gap-1"
    >
      <i class="fa-solid fa-plus"></i> 添加場地
    </button>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
    <!-- 場地區域 -->
    <div class="lg:col-span-2 space-y-4">
      <div *ngFor="let court of courts" class="border rounded p-4">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-bold">{{ court.name }}</h2>
          <div class="flex">
            <button
              (click)="autoAssignPlayers(court.id)"
              class="bg-yellow-500 text-white px-3 py-1 rounded flex items-center mr-2"
            >
              <i class="fas fa-users mr-1"></i> {{ court.players.length }} / 4
              自動分配
            </button>

            <button
              (click)="completeGame(court.id)"
              class="bg-green-500 text-white px-3 py-1 rounded flex items-center mr-2"
            >
                <i class="fas fa-flag-checkered mr-1"></i> 結束比賽
            </button>
            <button
              (click)="deleteCourt(court.id)"
              class="bg-red-500 text-white px-3 py-1 rounded flex items-center"
            >
              <i class="fas fa-trash-alt mr-1"></i> 刪除場地
            </button>
          </div>
        </div>

        <div class="grid grid-cols-2 sm:grid-cols-4 gap-2">
          <div
            *ngFor="let player of getCourtPlayers(court.id)"
            class="p-3 rounded flex flex-col justify-between bg-blue-100 border"
          >
            <div class="flex justify-between items-center">
              <div>
                <span class="font-medium">{{ player.name }}</span>
                <span class="text-sm text-gray-500 flex gap-2">等級：{{ getLevelDisplay(player.level) }}</span>
              </div>
              <button
                (click)="removePlayerFromCourt(court.id, player.id)"
                class="text-red-500"
              >
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>

          <!-- 空位 -->
          <div
            *ngFor="let _ of getEmptySlots(court.id)"
            class="p-3 border border-dashed rounded flex items-center justify-center text-gray-400"
          >
            空位
          </div>
        </div>
      </div>
    </div>

    <!-- 等待區域 -->
    <div class="border rounded p-4">
      <div class="flex items-center mb-4">
        <i class="fas fa-users mr-2"></i>
        <h2 class="text-xl font-bold">等待隊列</h2>
        <span class="ml-2 bg-gray-200 px-2 py-1 rounded-full text-sm">
          {{ getWaitingPlayers().length }}
        </span>
      </div>

      <div
        *ngIf="getWaitingPlayers().length === 0"
        class="text-center py-4 text-gray-500"
      >
        沒有等待中的玩家
      </div>

      <ul *ngIf="getWaitingPlayers().length > 0" class="space-y-2">
        <li
          *ngFor="let player of getWaitingPlayers(); let i = index"
          class="flex flex-col p-2 border rounded"
        >
          <div class="flex justify-between gap-3 mb-2 w-full">
            <div class="flex items-center gap-3">
              <!-- 編號圓圈 -->
              <!-- <span
                class="bg-gray-200 rounded-full w-6 h-6 flex items-center justify-center text-sm"
              >
                {{ i + 1 }}
              </span> -->

              <!-- 玩家資訊 -->

              <div class="font-medium">{{ player.name }}</div>
            </div>
            <div class="flex">
              <div class="dropdown mr-2">
                <select
                  class="border rounded p-1"
                  (change)="onCourtSelect($event, player.id)"
                >
                  <option value="">選擇場地</option>
                  <option
                    *ngFor="let court of courts"
                    [value]="court.id"
                    [disabled]="court.players.length >= 4"
                  >
                    {{ court.name }}
                    {{ court.players.length >= 4 ? "(已滿)" : "" }}
                  </option>
                </select>
              </div>
              <button (click)="removePlayer(player.id)" class="text-red-500">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>

          <div class="text-sm text-gray-500 flex gap-2">
            <span>等級：{{ getLevelDisplay(player.level) }}</span>
            <span>已上 {{ player.gamePlayed }} 場</span>
          </div>
        </li>
      </ul>
    </div>
  </div>
</div>
